(window.webpackJsonp=window.webpackJsonp||[]).push([[253],{851:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("A Piface extension board is attached to a Raspberry Pi via the GPIO connector. It has 8 digital input and 8 digital output pins. It is not possible to set the value of input pins, or read the value of output pins. There is plenty of documentation on the web about the Piface board and how it can be used.")]),t._v(" "),t._m(1),t._v(" "),a("p",[t._v("In order to communicate with the Raspberry Pi carrying the PiFace daughter board please install the scripts that can be found "),a("a",{attrs:{href:"https://github.com/openhab/openhab1-addons/tree/master/bundles/binding/org.openhab.binding.piface/scripts",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(". If you upgrade from an older openHAB version make sure that you update the scripts to avoid watchdog errors in your logfile.")]),t._v(" "),a("p",[t._v("In newer RasPi kernel versions the hardware resource allocation is handled by the "),a("a",{attrs:{href:"http://www.raspberrypi.org/documentation/configuration/device-tree.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("device tree"),a("OutboundLink")],1),t._v(". This may stop the SPI kernel module from loading after an update of the RasPi firmware ("),a("strong",[t._v("rpi-update")]),t._v(" command) even if the the ohpiface scripts are correctly installed and where already working. If you experiencing issues please")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),a("p",[t._v("The command")]),t._v(" "),t._m(4),a("p",[t._v("or")]),t._v(" "),t._m(5),a("p",[t._v("checks if the kernel module is loaded. If the module is loaded you will get output like")]),t._v(" "),t._m(6),a("p",[t._v("if not - no output is generated.")]),t._v(" "),t._m(7),t._v(" "),a("p",[t._v("If the module is not loaded you may try")]),t._v(" "),t._m(8),a("p",[t._v("to load the kernel module. If you get an error message")]),t._v(" "),t._m(9),t._v(" "),a("p",[t._v("Add the line")]),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),a("p",[t._v("The syntax (by way of example) of the item configuration is shown below:")]),t._v(" "),t._m(19),a("p",[t._v("In this example the first item is a Switch, which when activated in openHAB, will set OUTPUT pin 1 on the Piface board high/low. I.e. this is enabling openHAB to turn on/off something in the real-world - e.g. a garage door opener.")]),t._v(" "),a("p",[t._v("The second item is a Contact item which will be updated to open/closed when INPUT pin 1 on the Piface board is set high/low. I.e. this is reading the state of something in the real-world - e.g. it could be a reed switch on a garage door.")]),t._v(" "),a("p",[t._v("When the binding is initialised, it will attempt to read the current state of any INPUT pins and update the items on the openHAB event bus. Output pins cannot be read currently so should be initialised to a known state by a rule in your openHAB configuration.")]),t._v(" "),t._m(20),t._v(" "),a("p",[t._v("WATCHDOG monitor ensures your Pi is connected and responding. No further configuration is required as long as you do not want to make use of the watchdog feature.")]),t._v(" "),t._m(21),t._v(" "),t._m(22),t._m(23),t._v(" "),a("p",[t._v("Below is an example of my setup. I am using one of the output relays to control my underfloor heating system, and the other to activate my garage door opener. I also have 3 inputs configured, one from the underfloor thermostat controller, one from a reed switch on my garage door, and one attached to a homemade water sensor (just two pieces of aluminium foil wrapped around a piece of plastic with a 5mm gap).")]),t._v(" "),t._m(24),t._v(" "),t._m(25),t._m(26),t._v(" "),a("p",[t._v("The rules for these items are below. The underfloor heating rule is pretty simple, if the thermostat decides it is time to heat openHAB simply passes this signal onto the heat pump, unless I am away on holiday! There is also a rule to check if the forecast is for a cold day ahead, and if the heat pump isn't already running at 5am, to give the heating a boost for a couple of hours. It should be noted I only run the heat pump from 9pm till 7am as this is when I get cheap power.")]),t._v(" "),t._m(27),t._m(28),t._v(" "),a("p",[t._v("The garage door opener is a simple rule that effectively turns the switch into a 'button press', simulating the button being held down for one second. I also have a few notifications setup so any XBMC instances that are running get a popup when the garage door is opened. There are other rules linked to the garage door as well, i.e. to turn on the internal garage light for 5 mins when the door is opened.")]),t._v(" "),t._m(29),t._m(30),t._v(" "),a("p",[t._v("The HWC sensor rule is there to alert me of any leak and to 'dampen' the notification frequency, since my sensor tends to change rapidly when it gets wet - flicking on/off very quickly!")]),t._v(" "),t._m(31),a("DocPreviousVersions"),t._v(" "),a("EditPageLink")],1)},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"piface-binding"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#piface-binding","aria-hidden":"true"}},[this._v("#")]),this._v(" Piface Binding")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"prerequisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[this._v("#")]),this._v(" Prerequisites")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",[a("li",[t._v("Check if the SPI kernel module is loaded")]),t._v(" "),a("li",[t._v("Check if the SPI kernel module can be loaded")]),t._v(" "),a("li",[t._v("Modify "),a("strong",[t._v("/boot/config.txt")]),t._v(" to enable SPI in the device tree")]),t._v(" "),a("li",[t._v("Reboot your Raspberry")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"check-if-the-spi-kernel-module-spi-bcm2708-or-spi-bcm2835-is-loaded"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#check-if-the-spi-kernel-module-spi-bcm2708-or-spi-bcm2835-is-loaded","aria-hidden":"true"}},[this._v("#")]),this._v(" Check if the SPI kernel module (spi_bcm2708 or spi_bcm2835) is loaded")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("lsmod | grep spi_bcm2708\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("lsmod | grep spi_bcm2835\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("spi_bcm2708             6018  0\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"check-if-the-spi-kernel-module-can-be-loaded"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#check-if-the-spi-kernel-module-can-be-loaded","aria-hidden":"true"}},[this._v("#")]),this._v(" Check if the SPI kernel module can be loaded")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("modprobe spi_bcm2708\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"enable-spi-in-the-device-tree"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enable-spi-in-the-device-tree","aria-hidden":"true"}},[this._v("#")]),this._v(" Enable SPI in the device tree")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("device_tree_param=spi=on\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("to the file "),s("code",[this._v("/boot/config.txt")]),this._v(" to enable SPI in the device tree and reboot. The kernel module should now load into the kernel and the ohpiface scripts should work again.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"binding-configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binding-configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Binding Configuration")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("This binding can be configured in the file "),s("code",[this._v("services/piface.cfg")]),this._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("The binding supports multiple Piface devices by specifying a unique "),s("code",[this._v("<PifaceId>")]),this._v(" in the binding configuration. The "),s("code",[this._v("<PifaceId>")]),this._v(" is used in the item configuration to identify which device it is associated with.")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("table",[a("thead",[a("tr",[a("th",[t._v("Property")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Required")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("<Pifaceid>")]),t._v(".host")]),t._v(" "),a("td"),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes")]),t._v(" "),a("td",[t._v("Host IP address of the Piface device")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("<Pifaceid>")]),t._v(".listenerport")]),t._v(" "),a("td",[t._v("15432")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[t._v("Port the Piface device is listening on for commands FROM the binding")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("<Pifaceid>")]),t._v(".monitorport")]),t._v(" "),a("td",[t._v("15433")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[t._v("Port the Piface device uses to send updates TO the binding")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("<Pifaceid>")]),t._v(".sockettimeout")]),t._v(" "),a("td",[t._v("1000")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[t._v("Socket timeout in milliseconds when sending packets")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("<Pifaceid>")]),t._v(".maxretries")]),t._v(" "),a("td",[t._v("3")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[t._v("Number of retry attempts before failing a packet")])]),t._v(" "),a("tr",[a("td",[t._v("watchdog.interval")]),t._v(" "),a("td",[t._v("60000")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[t._v("Watchdog polling interval in milliseconds")])])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("where "),a("code",[t._v("<Pifaceid>")]),t._v(" is a simple name you choose for a specific Piface device; the name is used in your item configurations (see below).  Do not use "),a("code",[t._v("watchdog")]),t._v(" for "),a("code",[t._v("<Pifaceid>")]),t._v(" as it is reserved.  You can repeat entries in "),a("code",[t._v("services/piface.cfg")]),t._v(" to address multiple Piface devices.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"item-configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#item-configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Item Configuration")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("The binding supports Switch and Contact item types only. In order to associate an item with a particular Piface pin/port, you must first define the "),s("code",[this._v("<PifaceId>")]),this._v(", as configured in the binding configuration, and then specify the pin type and number.")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dsl"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("/* Two Piface items - an OUT switch, and an IN contact */")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("Switch")]),t._v("     "),a("span",{attrs:{class:"token class-name"}},[t._v("PifaceSwitch1")]),t._v("       "),a("span",{attrs:{class:"token string"}},[t._v('"Switch 1"')]),t._v("  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" piface"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"pifaceid1:OUT:1"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("Contact")]),t._v("    "),a("span",{attrs:{class:"token class-name"}},[t._v("PifaceContact1")]),t._v("      "),a("span",{attrs:{class:"token string"}},[t._v('"Contact 1"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" piface"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"pifaceid1:IN:1"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"watchdog"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#watchdog","aria-hidden":"true"}},[this._v("#")]),this._v(" Watchdog")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("By binding a switch/contact item to the WATCHDOG command for a Piface board you will be able to check your Pi is alive. The watchdog polling interval is configured in your "),s("a",{attrs:{href:"#binding-configuration"}},[this._v("binding configuration")]),this._v(".")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dsl"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("Switch")]),t._v("  "),a("span",{attrs:{class:"token class-name"}},[t._v("PiFaceWatchDog1")]),t._v("        "),a("span",{attrs:{class:"token string"}},[t._v('"Watchdog 1"')]),t._v("  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" piface"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"pifaceid1:WATCHDOG"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"examples"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#examples","aria-hidden":"true"}},[this._v("#")]),this._v(" Examples")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"item-definitions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#item-definitions","aria-hidden":"true"}},[this._v("#")]),this._v(" Item Definitions")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dsl"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// Underfloor heating")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("Switch")]),t._v("   "),a("span",{attrs:{class:"token class-name"}},[t._v("UFThermostat")]),t._v("      "),a("span",{attrs:{class:"token string"}},[t._v('"Underfloor Thermostat"')]),a("span",{attrs:{class:"token function"}},[t._v(" <heating>")]),t._v("        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" piface"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"piface1:IN:0"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("Switch")]),t._v("   "),a("span",{attrs:{class:"token class-name"}},[t._v("UFHeatpump")]),t._v("        "),a("span",{attrs:{class:"token string"}},[t._v('"Underfloor Heatpump"')]),t._v("  "),a("span",{attrs:{class:"token function"}},[t._v(" <heating>")]),t._v("        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" piface"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"piface1:OUT:1"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// Garage door")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("Contact")]),t._v("  "),a("span",{attrs:{class:"token class-name"}},[t._v("GarageDoor")]),t._v("        "),a("span",{attrs:{class:"token string"}},[t._v('"Garage Door [%s]"')]),t._v("     "),a("span",{attrs:{class:"token function"}},[t._v(" <garagedoor>")]),t._v("     "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" piface"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"piface1:IN:3"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("Switch")]),t._v("   "),a("span",{attrs:{class:"token class-name"}},[t._v("GarageDoorOpener")]),t._v("  "),a("span",{attrs:{class:"token string"}},[t._v('"Garage Door Opener"')]),t._v("   "),a("span",{attrs:{class:"token function"}},[t._v(" <remotecontrol>")]),t._v("  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" piface"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"piface1:OUT:0"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// Hot Water Cylinder cupboard water sensor")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("Switch")]),t._v("   "),a("span",{attrs:{class:"token class-name"}},[t._v("HWCWaterSensor")]),t._v("    "),a("span",{attrs:{class:"token string"}},[t._v('"HWC Water Sensor"')]),t._v("     "),a("span",{attrs:{class:"token function"}},[t._v(" <watersensor>")]),t._v("    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" piface"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"piface1:IN:7"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"heating-rules"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#heating-rules","aria-hidden":"true"}},[this._v("#")]),this._v(" Heating Rules")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-rules"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// turn on/off the underfloor heatpump based on the thermostat")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("rule")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Underfloor heating"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("when")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("Item")]),t._v(" UFThermostat "),a("span",{attrs:{class:"token keyword"}},[t._v("changed")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// don't turn on heating if we are on 'holiday' (unless there is a house sitter)")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function-name"}},[t._v("Holidays_Holiday")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{attrs:{class:"token function-name"}},[t._v("Presence_HouseSitter")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function-name"}},[t._v("UFThermostat")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{attrs:{class:"token function"}},[t._v("sendCommand")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UFHeatpump"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n            "),a("span",{attrs:{class:"token function"}},[t._v("sendCommand")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UFHeatpump"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("OFF")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// if the underfloor heatpump is off at 5am and tomorrow is looking")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// cold then we give the underfloor a boost for a couple of hours")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("rule")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Underfloor boost"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("when")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("Time cron")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"0 0 5 * * ?"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// the minimum forecast max temperature before we attempt to boost")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" boostTempThreshold "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("10")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// don't turn on heating if we are on 'holiday' (unless there is a house sitter)")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function-name"}},[t._v("Holidays_Holiday")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{attrs:{class:"token function-name"}},[t._v("Presence_HouseSitter")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// if the heat pump is currently off then check the weather forecast for today")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function-name"}},[t._v("UFHeatpump")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("OFF")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{attrs:{class:"token function-name"}},[t._v("Weather_TodayMax")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" boostTempThreshold"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token function"}},[t._v("sendCommand")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UFHeatpump"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{attrs:{class:"token function"}},[t._v("sendTweet")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Boosting underfloor heating since it looks chilly today"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("rule")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Shutoff underfloor heating"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("when")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("Time cron")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"0 0 7 * * ?"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function-name"}},[t._v("UFHeatpump")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("sendCommand")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UFHeatpump"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("OFF")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"garage-door-rules"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#garage-door-rules","aria-hidden":"true"}},[this._v("#")]),this._v(" Garage Door Rules")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-rules"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Timer")]),t._v(" openGarageDoorTimer "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("null")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("rule")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Garage door opener"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("when")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("Item")]),t._v(" GarageDoorOpener "),a("span",{attrs:{class:"token keyword"}},[t._v("received command")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("openGarageDoorTimer "),a("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("null")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        openGarageDoorTimer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("cancel")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// release the garage door 'opener' after a short delay")]),t._v("\n    openGarageDoorTimer "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("createTimer")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("now"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("plusSeconds")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("sendCommand")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GarageDoorOpener"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("OFF")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("rule")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Garage door open notification"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("when")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("Item")]),t._v(" GarageDoor "),a("span",{attrs:{class:"token keyword"}},[t._v("changed")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("OPEN")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("sendXbmcNotification")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"192.168.1.40"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("80")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"openHAB Alert"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Garage door is open!"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("sendXbmcNotification")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"192.168.1.41"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("80")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"openHAB Alert"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Garage door is open!"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"hwc-sensor-rules"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hwc-sensor-rules","aria-hidden":"true"}},[this._v("#")]),this._v(" HWC Sensor Rules")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-rules"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("rule")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"HWC Water Sensor"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("when")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("Item")]),t._v(" HWCWaterSensor "),a("span",{attrs:{class:"token keyword"}},[t._v("changed")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("ON")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// the water sensor can rapidly switch on/off when water detected - don't want 100's of alerts")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// so ignore all activations for 5 mins once it is triggered")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("ignore_HWCWaterSensor"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// send an email and notification")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("sendMail")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"xxx@xxx.com"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"openHAB Alert"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"WATER detected in HWC cupboard!!!"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("sendXMPP")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"xxx@xxx.com"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"WATER detected in HWC cupboard!!!"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// send a notification to both XBMCs")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("sendXbmcNotification")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"192.168.1.40"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("80")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"openHAB Alert"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"WATER detected in HWC cupboard!!!"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("sendXbmcNotification")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"192.168.1.41"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("80")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"openHAB Alert"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"WATER detected in HWC cupboard!!!"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// we only send the alerts once every 5 mins")]),t._v("\n        ignore_HWCWaterSensor "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timer_HWCWaterSensor "),a("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("null")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            timer_HWCWaterSensor"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("cancel")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// reset the ignore sensor flag after 5 mins")]),t._v("\n        timer_HWCWaterSensor "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("createTimer")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("now"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("plusMinutes")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("5")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n            ignore_HWCWaterSensor "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])])}],!1,null,null,null);e.options.__file="readme.md";s.default=e.exports}}]);