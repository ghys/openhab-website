(window.webpackJsonp=window.webpackJsonp||[]).push([[410],{446:function(e,t,a){"use strict";a.r(t);var i=a(0),n=Object(i.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[e._m(0),e._v(" "),a("p",[e._v("The following guidelines apply to all (Java) code of the openHAB project.\nThey must be followed to ensure a consistent code base for easy readability and maintainability.\nExceptions can certainly be made, but they should be discussed and approved by a project maintainer upfront.")]),e._v(" "),a("p",[e._v("Note that this list also serves as a checklist for code reviews on pull requests.\nTo speed up the contribution process, we therefore advice to go through this checklist yourself before creating a pull request.")]),e._v(" "),e._m(1),e._v(" "),a("ol",[a("li",[e._v("The "),a("a",{attrs:{href:"http://java.about.com/od/javasyntax/a/nameconventions.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("Java naming conventions"),a("OutboundLink")],1),e._v(" should be used.")]),e._v(" "),e._m(2),e._v(" "),a("li",[e._v("Every class, interface and enumeration should have JavaDoc describing its purpose and usage.")]),e._v(" "),e._m(3),e._v(" "),a("li",[e._v("Every constant, field and method with default, protected or public visibility should have JavaDoc (optional, but encouraged for private visibility as well).")]),e._v(" "),a("li",[e._v("Code must be formatted using the provided code formatter and clean up settings. They are set up automatically by the official "),a("router-link",{attrs:{to:"./ide.html"}},[e._v("IDE setup")]),e._v(".")],1),e._v(" "),a("li",[e._v("Generics must be used where applicable.")]),e._v(" "),e._m(4),e._v(" "),a("li",[e._v("For dependency injection, OSGi Declarative Services should be used.")]),e._v(" "),a("li",[e._v("OSGi Declarative Services should be declared using annotations. The IDE will take care of the service "),a("code",[e._v("*.xml")]),e._v(" file creation. See the official OSGi documentation for an "),a("a",{attrs:{href:"http://enroute.osgi.org/services/org.osgi.service.component.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("example here"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("li",[e._v('Packages that contain classes that are not meant to be used by other bundles should have "internal" in their package name.\n'),a("a",{attrs:{href:"https://wiki.eclipse.org/JDT_Core/Null_Analysis",target:"_blank",rel:"noopener noreferrer"}},[e._v("Null annotations"),a("OutboundLink")],1),e._v(" are used from the Eclipse JDT project. "),a("code",[e._v("@NonNullByDefault")]),e._v(" and "),a("code",[e._v("@Nullable")]),e._v(" should be used, for details see "),a("router-link",{attrs:{to:"./conventions.html#null-annotations"}},[e._v("Null annotation conventions")]),e._v(".")],1)]),e._v(" "),e._m(5),e._v(" "),a("ol",{attrs:{start:"7"}},[a("li",[e._v("Every bundle must contain a Maven pom.xml with a version and artifact name that is in sync with the manifest entry. The pom.xml must reference the correct parent pom (which is usually in the parent folder).")]),e._v(" "),a("li",[e._v("Every bundle must contain an about.html file, providing license information. If there is a third-party software in the bundle, its licence information must be added to the bundle's about.html file and the date in the about.html files must be changed to the current. You can look at and use these two examples: "),a("a",{attrs:{href:"https://github.com/openhab/openhab2-addons/blob/master/addons/ui/org.openhab.ui.cometvisu.php/about.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("about.html without 3rd party licence information"),a("OutboundLink")],1),e._v(" and "),a("a",{attrs:{href:"https://github.com/openhab/openhab2-addons/blob/master/addons/binding/org.openhab.binding.avmfritz/about.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("about.html with 3rd party licence information"),a("OutboundLink")],1),e._v(".")]),e._v(" "),e._m(6),e._v(" "),a("li",[e._v('The manifest must not contain any "Require-Bundle" entries. Instead, "Import-Package" must be used.')]),e._v(" "),a("li",[e._v("The manifest must not export any internal package.")]),e._v(" "),a("li",[e._v("The manifest must not have any version constraint on package imports, unless this is thoughtfully added. Note that Eclipse automatically adds these constraints based on the version in the target platform, which might be too high in many cases.")]),e._v(" "),e._m(7),e._v(" "),a("li",[e._v("Every exported package of a bundle must be imported by the bundle itself again.")]),e._v(" "),a("li",[e._v("Any 3rd party content has to be added thoughtfully and version/license information has to be given in the NOTICE file.")])]),e._v(" "),e._m(8),e._v(" "),e._m(9),e._v(" "),a("ul",[a("li",[e._v("To allow optimized JavaSE 8 runtimes, the set of Java packages to be used is furthermore restricted to "),a("a",{attrs:{href:"http://www.oracle.com/technetwork/java/embedded/resources/tech/compact-profiles-overview-2157132.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Compact Profile 2"),a("OutboundLink")],1)])]),e._v(" "),a("ol",[a("li",[e._v("The minimum OSGi framework version supported is "),a("a",{attrs:{href:"http://www.osgi.org/Download/Release4V42",target:"_blank",rel:"noopener noreferrer"}},[e._v("OSGi R4.2"),a("OutboundLink")],1),e._v(", no newer features must be used.")]),e._v(" "),a("li",[e._v("For logging, slf4j (v1.7.2) is used.")]),e._v(" "),a("li",[e._v("A few common utility libraries are available that every Eclipse SmartHome based solution has to provide and which can be used throughout the code (and which are made available in the target platform):")])]),e._v(" "),e._m(10),e._v(" "),e._m(11),e._v(" "),a("ol",[a("li",[e._v("Overridden methods from abstract classes or interfaces are expected to return fast unless otherwise stated in their JavaDoc. Expensive operations should therefore rather be scheduled as a job.")]),e._v(" "),a("li",[e._v("Creation of threads must be avoided. Instead, resort into using existing schedulers which use pre-configured thread pools. If there is no suitable scheduler available, start a discussion in the forum about it rather than creating a thread by yourself. For periodically executed jobs that do not require a fixed rate "),a("a",{attrs:{href:"http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ScheduledExecutorService.html#scheduleWithFixedDelay(java.lang.Runnable,%20long,%20long,%20java.util.concurrent.TimeUnit)",target:"_blank",rel:"noopener noreferrer"}},[e._v("scheduleWithFixedDelay"),a("OutboundLink")],1),e._v(" should be preferred over "),a("a",{attrs:{href:"http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ScheduledExecutorService.html#scheduleAtFixedRate(java.lang.Runnable,%20long,%20long,%20java.util.concurrent.TimeUnit)",target:"_blank",rel:"noopener noreferrer"}},[e._v("scheduleAtFixedRate"),a("OutboundLink")],1),e._v(".")]),e._v(" "),e._m(12),e._v(" "),a("li",[e._v('Bundles must not require any substantial CPU time. Test this e.g. using "top" or VisualVM and compare CPU utilization with your bundle stopped vs. started.')])]),e._v(" "),e._m(13),e._v(" "),a("ol",[a("li",[e._v("As we are in a dynamic OSGi environment, loggers should be "),a("a",{attrs:{href:"http://slf4j.org/faq.html#declared_static",target:"_blank",rel:"noopener noreferrer"}},[e._v("non-static"),a("OutboundLink")],1),e._v(", when ever possible and have the name "),a("code",[e._v("logger")]),e._v(".")]),e._v(" "),a("li",[e._v("Parametrized logging must be used (instead of string concatenation).")]),e._v(" "),a("li",[e._v("Where ever unchecked exceptions are caught and logged, the exception should be added as a last parameter to the logging. For checked exceptions, this is normally not recommended, unless it can be considered an error situation and the stacktrace would hold additional important information for the analysis.")]),e._v(" "),a("li",[e._v("Logging levels should focus on the system itself and describe its state. As every bundle is only one out of many, logging should be done very scarce. It should be up to the user to increase the logging level for specific bundles, packages or classes if necessary. This means in detail:")])]),e._v(" "),e._m(14),e._v(" "),e._m(15),e._v(" "),e._m(16),e._v(" "),a("p",[e._v("The openHAB Maven build includes "),a("a",{attrs:{href:"https://github.com/openhab/static-code-analysis",target:"_blank",rel:"noopener noreferrer"}},[e._v("tooling for static code analysis"),a("OutboundLink")],1),e._v(" that will validate your code against the Coding Guidelines and some additional best practices.\nInformation about the checks can be found "),a("a",{attrs:{href:"https://github.com/openhab/static-code-analysis/blob/master/docs/included-checks.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(".")]),e._v(" "),e._m(17),e._v(" "),a("p",[e._v("Please fix all the priority 1 issues and all issues with priority 2 and 3 that are relevant (if you have any doubt don't hesitate to ask).\nRe-run the build to confirm that the checks are passing.")]),e._v(" "),a("DocPreviousVersions"),e._v(" "),a("EditPageLink")],1)},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"coding-guidelines"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#coding-guidelines","aria-hidden":"true"}},[this._v("#")]),this._v(" Coding Guidelines")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"a-code-style"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#a-code-style","aria-hidden":"true"}},[this._v("#")]),this._v(" A. Code Style")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[this._v("Every Java file must have a license header. You can run "),t("code",[this._v("mvn license:format")]),this._v(" on the root of the repo to automatically add missing headers.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[this._v("Every class, interface and enumeration must have an "),t("code",[this._v("@author")]),this._v(" tag in its JavaDoc for every author that wrote a substantial part of the file.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[this._v("Code should not show any warnings. Warnings that cannot be circumvented should be suppressed by using the "),t("code",[this._v("@SuppressWarnings")]),this._v(" annotation.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"b-osgi-bundles"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#b-osgi-bundles","aria-hidden":"true"}},[this._v("#")]),this._v(" B. OSGi Bundles")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[this._v("Every bundle must contain a build.properties file, which lists all resources that should end up in the binary under "),t("code",[this._v("bin.includes")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[this._v("The manifest must include all services in the Service-Component entry. A good approach is to put "),t("code",[this._v("OSGI-INF/*.xml")]),this._v(" in there.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"c-language-levels-and-libraries"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#c-language-levels-and-libraries","aria-hidden":"true"}},[this._v("#")]),this._v(" C. Language Levels and Libraries")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ol",[t("li",[this._v("Eclipse SmartHome generally targets JavaSE 8 with the following restrictions:")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Apache Commons IO (v2.2)")]),this._v(" "),t("li",[this._v("Apache Commons Lang (v2.6)")]),this._v(" "),t("li",[t("s",[this._v("Google Guava (v10.0.1)")]),this._v(" (historically allowed, to be avoided in new contributions)")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"d-runtime-behavior"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#d-runtime-behavior","aria-hidden":"true"}},[this._v("#")]),this._v(" D. Runtime Behavior")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[this._v("Bundles need to cleanly start and stop without throwing exceptions or malfunctioning. This can be tested by manually starting and stopping the bundle from the console ("),t("code",[this._v("stop <bundle-id>")]),this._v(" resp. "),t("code",[this._v("start <bundle-id>")]),this._v(").")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"e-logging"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#e-logging","aria-hidden":"true"}},[this._v("#")]),this._v(" E. Logging")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ul",[a("li",[e._v("Most logging should be done in "),a("code",[e._v("debug")]),e._v(" level. "),a("code",[e._v("trace")]),e._v(" can be used for even more details, where necessary.")]),e._v(" "),a("li",[e._v("Only few important things should be logged in "),a("code",[e._v("info")]),e._v(" level, e.g. a newly started component or a user file that has been loaded.")]),e._v(" "),a("li",[a("code",[e._v("warn")]),e._v(" logging should only be used to inform the user that something seems to be wrong in his overall setup, but the system can nonetheless function as normal, while possibly ignoring some faulty configuration/situation. It can also be used in situations, where a code section is reached, which is not expected by the implementation under normal circumstances (while being able to automatically recover from it).")]),e._v(" "),a("li",[a("code",[e._v("error")]),e._v(" logging should only be used to inform the user that something is tremendously wrong in his setup, the system cannot function normally anymore, and there is a need for immediate action. It should also be used if some code fails irrecoverably and the user should report it as a severe bug.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ol",[t("li",[this._v("For bindings, you should NOT log errors, if e.g. connections are dropped - this is considered to be an external problem and from a system perspective to be a normal and expected situation. The correct way to inform users about such events is to update the Thing status accordingly. Note that all events (including Thing status events) are anyhow already logged.")]),this._v(" "),t("li",[this._v("Likewise, bundles that accept external requests (such as servlets) must not log errors or warnings if incoming requests are incorrect. Instead, appropriate error responses should be returned to the caller.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"static-code-analysis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#static-code-analysis","aria-hidden":"true"}},[this._v("#")]),this._v(" Static Code Analysis")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The tool will generate an individual report for each bundle that you can find in "),t("code",[this._v("path/to/bundle/target/code-analysis/report.html")]),this._v(" file and a report for the whole build that contains links to the individual reports in the "),t("code",[this._v("target/summary_report.html")]),this._v(".\nThe tool categorizes the found issues by priority: 1(error),2(warning) or 3(info).\nIf any error is found within your code the Maven build will end with failure.\nYou will receive detailed information (path to the file, line and message) listing all problems with Priority 1 on the console.")])}],!1,null,null,null);n.options.__file="guidelines.md";t.default=n.exports}}]);